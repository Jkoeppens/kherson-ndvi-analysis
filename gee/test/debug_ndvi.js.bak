// ğŸ§ª Debug-Skript fÃ¼r getYearlyNDVI
(function debugNDVI() {
  var regionKey = 'kherson';
  var year = 2022;

  if (!isValidRegion(regionKey)) {
    print('âŒ UngÃ¼ltiger RegionKey:', regionKey);
    return;
  }

  var region = regionDefs[regionKey];
  var start = ee.Date.fromYMD(year, config.analysisMonths[0], 1);
  var end = ee.Date.fromYMD(year, config.analysisMonths[1] + 1, 1);

  print('ğŸ—ºï¸ Region:', region);
  print('ğŸ—“ï¸ Zeitraum:', start, 'bis', end);

  var collectionRaw = ee.ImageCollection('COPERNICUS/S2_SR')
    .filterBounds(region)
    .filterDate(start, end);

  print('ğŸ“‚ Rohbilder (Anzahl):', collectionRaw.size());

  var exampleBefore = ee.Image(collectionRaw.first());
  print('ğŸ§¼ Vor maskSCL:', exampleBefore);

  var collectionMasked = collectionRaw.map(maskSCL);
  var exampleMasked = ee.Image(collectionMasked.first());
  print('ğŸ§¼ Nach maskSCL (Beispielbild):', exampleMasked);

  var collectionWithNDVI = collectionMasked.map(addNDVI);
  var exampleNDVI = ee.Image(collectionWithNDVI.first()).select('NDVI');
  print('ğŸŒ¿ addNDVI() angewendet:', exampleNDVI);

  var ndviMedian = collectionWithNDVI
    .select('NDVI')
    .median()
    .clip(region)
    .updateMask(collectionWithNDVI.select('NDVI').median().neq(0))
    .rename('NDVI');

  print('ğŸ“Š NDVI-Median:', ndviMedian);

  // ğŸ”¢ GÃ¼ltige Beobachtungen
  var validObs = collectionWithNDVI
    .select('NDVI')
    .map(function(img) {
      return img.mask().rename('valid').uint8();
    })
    .sum()
    .rename('valid_obs');

  print('ğŸ“Š GÃ¼ltige Beobachtungen:', validObs);

  // ğŸŒ¾ Cropland-Maske
  if (config.useCroplandMask) {
    var cropland = ee.Image(config.croplandSource)
      .updateMask(
        ee.Image(config.croplandSource).gt(0)
          .and(ee.Image(config.croplandSource).lt(254))
      )
      .clip(region);
    print('ğŸŒ¾ Cropland-Maske:', cropland);

    ndviMedian = ndviMedian.updateMask(cropland);
    print('âœ… Cropland-Maske angewendet');
  }

  // ğŸ“ˆ Statistik
  var stats = ndviMedian.reduceRegion({
    reducer: ee.Reducer.minMax().combine({
      reducer2: ee.Reducer.mean().combine({
        reducer2: ee.Reducer.stdDev(),
        sharedInputs: true
      }),
      sharedInputs: true
    }),
    geometry: region,
    scale: config.scale,
    maxPixels: config.maxPixels
  });

  print('ğŸ“ˆ NDVI-Statistik:', stats);

  // ğŸ“Š Histogramm
  var histo = ndviMedian.reduceRegion({
    reducer: ee.Reducer.histogram({maxBuckets: 30}),
    geometry: region,
    scale: config.scale,
    maxPixels: config.maxPixels
  });

  print('ğŸ“Š NDVI-Histogramm:', histo);
})();
